"use strict";

var _this = void 0;

// console.log("js start");

/* ========================================================================
 * init
 * ======================================================================== */
var $html = document.getElementsByTagName("html");
var $body = document.getElementsByTagName("body");
/* --- Common letiable --- */

var $wrapper = document.querySelector(".wrapper");
var $wrapper_bg = document.querySelector(".wrapper__bg");
var ww = window.innerWidth;
var wh = window.innerHeight;
var w_breakPoint = 768;

var _sTop = document.documentElement.scrollTop || document.body.scrollTop;

var mousewheelevent = 'onwheel' in document ? 'wheel' : 'onmousewheel' in document ? 'mousewheel' : 'DOMMouseScroll';
/* --- 画像preload --- */

var is_ready = false;
var is_cssImg = false;
var $allImage = document.querySelectorAll(".main img");
var allImageCount = $allImage.length;
var completeImageCount = 0;
var cssImgResults = [];
var cssSheets = document.styleSheets;
var completecssImageCount = 0;
/* --- hover 処理 --- */

var $hover = document.querySelectorAll(".js-hover");
/*--アンカーリンク処理 --- */

var $ancLink = document.querySelectorAll("a[href^='#']");
/* --- スライドフェードイン --- */

var $sliSL = document.querySelectorAll(".js-sliSL");
var sliSLArr = [];
var sliSLFlagArr = [];
var sliSLTopArr = [];

for (var sliSLCount = 0; sliSLCount < $sliSL.length; sliSLCount++) {
  $sliSL[sliSLCount].style.opacity = 0;
}

var $stgSL = document.querySelectorAll(".js-stgSL");
var stgSLArr = [];
var stgSLFlagArr = [];
var stgSLTopArr = [];

for (var stgSLCount = 0; stgSLCount < $stgSL.length; stgSLCount++) {
  var $stgSLChild = $stgSL[stgSLCount].children;

  for (var stgSLChildCount = 0; stgSLChildCount < $stgSLChild.length; stgSLChildCount++) {
    $stgSLChild[stgSLChildCount].style.opacity = 0;
  }
}
/* --- SPメニュー --- */


var $gnav = document.querySelector(".gnav");
var $menuBtn = document.querySelector(".header__menubtn");
var is_gnav = false;
var is_open = false;
/* --- pageTop --- */

var $pageTop = document.querySelector(".pagetop");
var is_pageTop = false;
var _SP = false;

if (ww > w_breakPoint) {
  _SP = false;
} else {
  _SP = true;
}

window.addEventListener("resize", function (e) {
  ww = window.innerWidth;
  wh = window.innerHeight;

  if (ww > w_breakPoint) {
    _SP = false;
  } else {
    _SP = true;
  }
}); // setUA();

/* -----------------------------------------------
 * Ready imageなど遅延ロード
 * ----------------------------------------------- */

document.addEventListener("DOMContentLoaded", function () {
  console.log("ready"); // let tags = document.getElementsByTagName("*");

  try {
    if (Array.from) {
      (function () {
        var classesEle = Array.from(document.querySelectorAll('[class]')); // 全要素からクラス名を持つ要素を取得

        var classes = [];

        for (var i = 0; i < classesEle.length; i++) {
          classes.push(Array.from(classesEle[i].classList));
        }

        var flatten = Array.prototype.concat.apply([], classes);
        var set = new Set(flatten);
        var arrSet = Array.from(set); // 開いているHTMLから全クラス名を取得

        var cssStyle = [];

        for (var _i = 0; _i < arrSet.length; _i++) {
          var block = document.getElementsByClassName(arrSet[_i]);

          if (window.getComputedStyle(block[0]).getPropertyValue("background-image") !== "none") {
            cssStyle.push(window.getComputedStyle(block[0]).getPropertyValue("background-image"));
          } else if (window.getComputedStyle(block[0], "::after").getPropertyValue("background-image") !== "none") {
            cssStyle.push(window.getComputedStyle(block[0], "::after").getPropertyValue("background-image"));
          } else if (window.getComputedStyle(block[0], "::before").getPropertyValue("background-image") !== "none") {
            cssStyle.push(window.getComputedStyle(block[0], "::before").getPropertyValue("background-image"));
          }
        }

        if (cssStyle.length === 0) {
          is_ready = true;
          readySection();
        } else {
          for (var j = 0; j < cssStyle.length; j++) {
            // let img = new Image();
            var $imgnew = document.createElement("img"); // let imgurl = cssStyle[j].slice(5).slice(0, -2);

            var imgurl = cssStyle[j].replace(/"/g, '');
            imgurl = imgurl.slice(4).slice(0, -1);
            $imgnew.setAttribute("src", imgurl);
            $imgnew.addEventListener("load", function (response, status, xhr) {
              completecssImageCount++;

              if (completecssImageCount == cssStyle.length) {
                is_ready = true;
                readySection();
              }
            });
          }
        }
      })();
    } else {
      is_ready = true;
      readySection();
    }
  } catch (e) {
    // console.log("try");
    is_ready = true;
    readySection();
  }
});
/* -- imgタグ参照 -- */

var readySection = function readySection() {
  // console.log("section start");
  if (is_ready) {
    if (allImageCount < 1) {
      readyInit();
    } else {
      for (var i = 0; i < allImageCount; i++) {
        var image = new Image();
        var $src = $allImage[i].getAttribute('src');
        image.src = $src;
        var $new = document.createElement("img");
        $allImage[i].style.opacity = 0;

        if (!$src || image.width == 0) {
          completeImageCount++;
        } else {
          $new.addEventListener("load", function () {
            completeImageCount++;

            if (allImageCount == completeImageCount) {
              for (var j = 0; j < $allImage.length; j++) {
                $allImage[j].removeAttribute('style');
              }

              setTimeout(function () {
                readyInit();
              }, 100);
            }
          });
        }

        $new.setAttribute("src", $allImage[i].getAttribute('src'));
      }
    }
  }
};
/* -- Ready init (Loadが終わったら) -- */


var readyInit = function readyInit() {
  // console.log("init start");

  /* ホワイトバック */
  TweenMax.to($wrapper_bg, .6, {
    opacity: 0,
    onComplete: function onComplete() {
      $wrapper_bg.parentNode.removeChild($wrapper_bg); // scroll_flag = false;
    }
  });
  /* sliSL */

  var wscroll = _sTop + wh;

  for (var i = 0; i < sliSLTopArr.length; i++) {
    if (sliSLTopArr[i] <= wscroll) {
      sliSLFlagArr[i] = true;
      sliSLAnime(sliSLArr[i]);
    }
  }

  for (var _i2 = 0; _i2 < stgSLTopArr.length; _i2++) {
    if (stgSLTopArr[_i2] <= wscroll) {
      stgSLFlagArr[_i2] = true;
      stgSLInAnime(stgSLArr[_i2]);
    }
  }
};
/* -----------------------------------------------
 * sliSL stgSL
 * ----------------------------------------------- */

/* 単発slide */


for (var _sliSLCount = 0; _sliSLCount < $sliSL.length; _sliSLCount++) {
  var $this = $sliSL[_sliSLCount];
  sliSLArr[_sliSLCount] = $this;
  sliSLFlagArr[_sliSLCount] = false;
  sliSLTopArr[_sliSLCount] = $this.getBoundingClientRect().top;
}

var sliSLAnime = function sliSLAnime($obj) {
  TweenMax.killTweensOf($obj);

  if ($obj.classList.contains('js-sliSL-left')) {
    TweenMax.fromTo($obj, .7, {
      x: -20,
      opacity: 0
    }, {
      x: 0,
      opacity: 1,
      delay: .3,
      onComplete: function onComplete() {
        $obj.removeAttribute('style');
        $obj.classList.remove('js-sliSL', 'js-sliSL-left');
      }
    });
  } else if ($obj.classList.contains('js-sliSL-right')) {
    TweenMax.fromTo($obj, .7, {
      x: 20,
      opacity: 0
    }, {
      x: 0,
      opacity: 1,
      delay: .3,
      onComplete: function onComplete() {
        $obj.removeAttribute('style');
        $obj.classList.remove('js-sliSL', 'js-sliSL-right');
      }
    });
  } else if ($obj.classList.contains('js-sliSL-top')) {
    TweenMax.fromTo($obj, .7, {
      y: -20,
      opacity: 0
    }, {
      y: 0,
      opacity: 1,
      delay: .3,
      onComplete: function onComplete() {
        $obj.removeAttribute('style');
        $obj.classList.remove('js-sliSL', 'js-sliSL-top');
      }
    });
  } else if ($obj.classList.contains('js-sliSL-bottom')) {
    TweenMax.fromTo($obj, .7, {
      y: 20,
      opacity: 0
    }, {
      y: 0,
      opacity: 1,
      delay: .3,
      onComplete: function onComplete() {
        $obj.removeAttribute('style');
        $obj.classList.remove('js-sliSL', 'js-sliSL-bottom');
      }
    });
  } else {
    TweenMax.fromTo($obj, .7, {
      y: 20,
      opacity: 0
    }, {
      y: 0,
      opacity: 1,
      delay: .3,
      onComplete: function onComplete() {
        $obj.removeAttribute('style');
        $obj.classList.remove('js-sliSL');
      }
    });
  }
};
/* 連続したslide */


for (var _stgSLCount = 0; _stgSLCount < $stgSL.length; _stgSLCount++) {
  var _$this = $stgSL[_stgSLCount];
  stgSLArr[_stgSLCount] = _$this;
  stgSLFlagArr[_stgSLCount] = false;
  stgSLTopArr[_stgSLCount] = _$this.getBoundingClientRect().top;
}

var stgSLInAnime = function stgSLInAnime($obj) {
  if ($obj.classList.contains('js-stgSL-left')) {
    TweenMax.staggerFromTo($obj.children, .7, {
      x: -20,
      opacity: 0
    }, {
      x: 0,
      opacity: 1,
      delay: .3
    }, .15, function () {
      $obj.children.removeAttribute('style');
      $obj.classList.remove('js-stgSL', 'js-stgSL-left');
    });
  } else if ($obj.classList.contains('js-stgSL-right')) {
    TweenMax.staggerFromTo($obj.children, .7, {
      x: 20,
      opacity: 0
    }, {
      x: 0,
      opacity: 1,
      delay: .3
    }, .15, function () {
      $obj.children.removeAttribute('style');
      $obj.classList.remove('js-stgSL', 'js-stgSL-right');
    });
  } else if ($obj.classList.contains('js-stgSL-top')) {
    TweenMax.staggerFromTo($obj.children, .7, {
      y: -20,
      opacity: 0
    }, {
      y: 0,
      opacity: 1,
      delay: .3
    }, .15, function () {
      $obj.children.removeAttribute('style');
      $obj.classList.remove('js-stgSL', 'js-stgSL-top');
    });
  } else if ($obj.classList.contains('js-stgSL-bottom')) {
    TweenMax.staggerFromTo($obj.children, .7, {
      y: 20,
      opacity: 0
    }, {
      y: 0,
      opacity: 1,
      delay: .3
    }, .15, function () {
      $obj.children.removeAttribute('style');
      $obj.classList.remove('js-stgSL', 'js-stgSL-bottom');
    });
  } else {
    TweenMax.staggerFromTo($obj.children, .7, {
      y: 20,
      opacity: 0
    }, {
      y: 0,
      opacity: 1,
      delay: .3
    }, .15, function () {
      for (var i = 0; i < $obj.children.length; i++) {
        $obj.children[i].removeAttribute('style');
      }

      $obj.classList.remove('js-stgSL');
    });
  }
};
/* -----------------------------------------------
* スクロール禁止復活用関数
* ----------------------------------------------- */


var scrolloff = function scrolloff(event) {
  event.preventDefault();
};

var scroll_event = 'onwheel' in document ? 'wheel' : 'onmousewheel' in document ? 'mousewheel' : 'DOMMouseScroll';

var no_scroll = function no_scroll() {
  document.addEventListener.on(scroll_event, scrolloff);
  window.addEventListener('touchmove', scrolloff, {
    passive: false
  });
};

var return_scroll = function return_scroll() {
  document.removeEventListener(scroll_event);
  window.removeEventListener('touchmove', scrolloff, {
    passive: false
  });
};
/* ========================================================================
 * Event
 * ======================================================================== */

/* -----------------------------------------------
 * - スクロール -
 * ----------------------------------------------- */


window.addEventListener('scroll', function (e) {
  e.preventDefault();
  _sTop = document.body.scrollTop || document.documentElement.scrollTop;
  wh = window.innerHeight;

  var _sMdl = _sTop + wh / 2;

  var _sBtm = _sTop + wh;

  var diffVal = 100;
  /* sliSL */

  for (var i = 0; i < sliSLArr.length; i++) {
    if (!sliSLFlagArr[i] && sliSLTopArr[i] <= _sBtm - diffVal) {
      sliSLFlagArr[i] = true;
      sliSLAnime(sliSLArr[i]);
    }
  }
  /* stgSL */


  for (var _i3 = 0; _i3 < stgSLArr.length; _i3++) {
    if (!stgSLFlagArr[_i3] && stgSLTopArr[_i3] <= _sBtm - diffVal) {
      stgSLFlagArr[_i3] = true;
      stgSLInAnime(stgSLArr[_i3]);
    }
  }
});
/* -----------------------------------------------
 * SP メニュー
 * ----------------------------------------------- */

$menuBtn.addEventListener('click', function (e) {
  var h_gnav = Number(window.innerHeight);

  if (!is_gnav) {
    if (!is_open) {
      _sTop = document.documentElement.scrollTop || document.body.scrollTop;
      is_open = true;
      is_gnav = true;
      $menuBtn.classList.add("is-open");
      $wrapper.style.position = "fixed";
      $wrapper.style.top = -_sTop;
      $wrapper.style.left = 0;
      TweenMax.to($gnav, .3, {
        height: h_gnav,
        onComplete: function onComplete() {
          is_gnav = false;
        }
      });
    } else {
      $wrapper.removeAttribute('style');
      window.scrollTo(0, _sTop);
      is_open = false;
      is_gnav = true;
      $menuBtn.classList.remove("is-open");
      TweenMax.to($gnav, .3, {
        height: 0,
        onComplete: function onComplete() {
          is_gnav = false;
        }
      });
    }
  }
});
/* -----------------------------------------------
 * マウスオーバー - フェード
 * ----------------------------------------------- */

if (!_SP) {
  var _loop = function _loop(hoverCount) {
    $hover[hoverCount].addEventListener("mouseover", function () {
      TweenMax.to(_this, .2, {
        opacity: .5
      });
    });
    $hover[hoverCount].addEventListener("mouseout", function () {
      TweenMax.to(_this, .2, {
        opacity: 1,
        onComplete: function onComplete() {
          $hover[hoverCount].removeAttribute("style");
        }
      });
    });
  };

  for (var hoverCount = 0; hoverCount < $hover.length; hoverCount++) {
    _loop(hoverCount);
  }
}
/* -----------------------------------------------
 * ページトップ スクロール
 * ----------------------------------------------- */


$pageTop.addEventListener('click', function (e) {
  e.preventDefault();

  if (!is_pageTop) {
    is_pageTop = true;
    TweenMax.to(window, .8, {
      scrollTo: 0,
      onComplete: function onComplete() {
        is_pageTop = false;
      }
    });
  }
});
/* -----------------------------------------------
 * アンカークリック
 * ----------------------------------------------- */

for (var ancCount = 0; ancCount < $ancLink.length; ancCount++) {
  console.log($ancLink[ancCount]);
  $ancLink[ancCount].addEventListener("click", function (e) {
    e.preventDefault();
    console.log(e);
    var href = e.target.getAttribute("href");
    console.log(href);
    scrollAnc(href, .5);
  });
}

var scrollAnc = function scrollAnc($object, $speed) {
  var hash = $object;
  var $target;
  var t_hash;
  var h_h = document.querySelector(".header").clientHeight;

  if (hash === "#") {
    t_hash = 0;
  } else {
    console.log(hash);
    $target = document.querySelector(hash);
    t_hash = $target.getBoundingClientRect().top - h_h;
  }

  TweenMax.to(window, $speed, {
    scrollTo: t_hash
  });
}; // /* -----------------------------------------------
//  * ユーザーエージェントを取得
//  * ----------------------------------------------- */
// let setUA = () => {
// 	let ua = navigator.userAgent.toLowerCase();  //エージェント取得
// 	let ver = navigator.appVersion.toLowerCase(); //バージョンを取得
// 	let isMSIE = (ua.indexOf('msie') > -1) && (ua.indexOf('opera') == -1); // IE(11以外)
// 	let isIE6 = isMSIE && (ver.indexOf('msie 6.') > -1); // IE6
// 	let isIE7 = isMSIE && (ver.indexOf('msie 7.') > -1); // IE7
// 	let isIE8 = isMSIE && (ver.indexOf('msie 8.') > -1); // IE8
// 	let isIE9 = isMSIE && (ver.indexOf('msie 9.') > -1); // IE9
// 	let isIE10 = isMSIE && (ver.indexOf('msie 10.') > -1); // IE10
// 	let isIE11 = (ua.indexOf('trident/7') > -1); // IE11
// 	let isIE = isMSIE || isIE11; // IE
// 	let isEdge = (ua.indexOf('edge') > -1); // Edge
// 	let isChrome = (ua.indexOf('chrome') > -1) && (ua.indexOf('edge') == -1); // Google Chrome
// 	let isFirefox = (ua.indexOf('firefox') > -1); //Firefox
// 	let isSafari = (ua.indexOf('safari') > -1) && (ua.indexOf('chrome') == -1); // Safari
// 	let isOpera = (ua.indexOf('opera') > -1); // Opera
// }
// /* -----------------------------------------------
//  * FastClick.js
//  * ----------------------------------------------- */
// if ('addEventListener' in document) {
// 	document.addEventListener('DOMContentLoaded', () => {
// 		FastClick.attach(document.body);
// 	}, false);
// }